<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>インターン希望者登録ページ</title>
    <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        form { max-width: 500px; margin: auto; padding: 20px; border: 1px solid #ccc; border-radius: 10px; }
        label { display: block; margin-top: 10px; }
        select, textarea, input { width: 100%; padding: 8px; margin-top: 5px; }
        .error { color: red; font-size: 0.9em; }
        .buttons { margin-top: 15px; display: flex; flex-direction: column; align-items: center; }
        .dob-container { display: flex; gap: 10px; align-items: center; }
        .dob-container select { width: 32%; }
        .privacy-policy { font-size: 0.9em; text-align: center; margin-bottom: 10px; }
        #drop-area { border: 2px dashed #ccc; padding: 20px; text-align: center; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>
    <h2 style="text-align: center;">インターン希望者登録ページ</h2>
    <form id="registrationForm">
        <label>・名前（<span style="color: red;">必須</span>）<input type="text" id="name" required></label>
        <span class="error" id="error-name"></span>
        
        <label>・フリガナ（<span style="color: red;">必須</span>）<input type="text" id="furigana" required></label>
        <span class="error" id="error-furigana"></span>

       <label>・生年月日（<span style="color: red;">必須</span>）</label>
        <div class="dob-container">
            <select id="dob-year" required>
                <option value="">YYYY</option>
                <script>
                    for(let year = 1970; year <= 2020; year++) {
                        document.write(`<option value="${year}">${year}</option>`);
                    }
                </script>
            </select>
            /
            <select id="dob-month" required>
                <option value="">MM</option>
                <script>
                    for(let month = 1; month <= 12; month++) {
                        document.write(`<option value="${month}">${month}</option>`);
                    }
                </script>
            </select>
            /
            <select id="dob-day" required>
                <option value="">DD</option>
                <script>
                    for(let day = 1; day <= 31; day++) {
                        document.write(`<option value="${day}">${day}</option>`);
                    }
                </script>
            </select>
        </div>
        <span class="error" id="error-dob-year"></span>
        <span class="error" id="error-dob-month"></span>
        <span class="error" id="error-dob-day"></span>
        
        <label>・メールアドレス（<span style="color: red;">必須</span>）<input type="email" id="email" required></label>
        <span class="error" id="error-email"></span>
        
        <label>・電話番号（任意）<input type="tel" id="phone"></label>
        
        <label>・希望職種（<span style="color: red;">必須</span>）<input type="text" id="job" required></label>
        <span class="error" id="error-job"></span>
        
        <label>・希望勤務日程（<span style="color: red;">必須</span>）<textarea id="schedule" required></textarea></label>
        <span class="error" id="error-schedule"></span>
        
        <label>・経験の有無（<span style="color: red;">必須</span>）<input type="text" id="experience" required></label>
        <span class="error" id="error-experience"></span>
        
        <label>・スキル&自己PR（<span style="color: red;">必須</span>）<textarea id="skills" required></textarea></label>
        <span class="error" id="error-skills"></span>
        
        <label>・志望動機（<span style="color: red;">必須</span>）<textarea id="motivation" required></textarea></label>
        <span class="error" id="error-motivation"></span>
        
        <label>・写真アップロード（<span style="color: red;">必須</span>）</label>
        <div id="drop-area">ここにファイルをドラッグ&ドロップするか、クリックして選択</div>
        <input type="file" id="photo" accept="image/*" required style="display: none;">
        <span class="error" id="error-photo"></span>
        
        <div class="buttons">
            <button type="button" onclick="validateForm()">登録</button>
        </div>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const dropArea = document.getElementById("drop-area");
            const fileInput = document.getElementById("photo");
            
            dropArea.addEventListener("click", function() {
                fileInput.click();
            });
            
            dropArea.addEventListener("dragover", function(e) {
                e.preventDefault();
                this.style.borderColor = "#000";
            });
            
            dropArea.addEventListener("dragleave", function(e) {
                e.preventDefault();
                this.style.borderColor = "#ccc";
            });
            
            dropArea.addEventListener("drop", function(e) {
                e.preventDefault();
                this.style.borderColor = "#ccc";
                const file = e.dataTransfer.files[0];
                fileInput.files = e.dataTransfer.files;
                if (file) {
                    this.textContent = file.name;
                }
            });
            
            fileInput.addEventListener("change", function() {
                if (this.files.length > 0) {
                    dropArea.textContent = this.files[0].name;
                }
            });
        });

        function validateForm() {
            let isValid = true;
            document.querySelectorAll(".error").forEach(el => el.textContent = "");

            let formData = {};
            document.querySelectorAll("[required]").forEach(input => {
                if (!input.value.trim()) {
                    let errorElement = document.getElementById("error-" + input.id);
                    if (errorElement) {
                        errorElement.textContent = "未入力です";
                    }
                    isValid = false;
                } else {
                    formData[input.id] = input.value;
                }
            });

            // 画像をBase64形式で取得
            let fileInput = document.getElementById("photo");
            if (fileInput.files.length > 0) {
                let reader = new FileReader();
                reader.onloadend = function () {
                    formData.photo = reader.result.split(',')[1]; // Base64データを取得

                    // EmailJSで画像を添付して送信
                    emailjs.send("YOUR_SERVICE_ID", "YOUR_TEMPLATE_ID", {
                        name: formData.name,
                        email: formData.email,
                        photo: formData.photo // 画像データを添付
                    }).then(function(response) {
                        console.log("メール送信成功", response.status, response.text);
                    }, function(error) {
                        console.log("メール送信失敗", error);
                    });

                    // Googleスプレッドシートへデータ送信
                    fetch("https://script.google.com/macros/s/YOUR_DEPLOYED_WEB_APP_URL/exec", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(formData)
                    }).then(response => response.text())
                    .then(data => console.log("Googleスプレッドシートに登録成功: ", data))
                    .catch(error => console.log("Googleスプレッドシート登録失敗: ", error));

                    window.location.href = "confirmation.html";
                };
                reader.readAsDataURL(fileInput.files[0]);
            }
        }

        function doPost(e) {
          var sheet = SpreadsheetApp.openById("YOUR_SPREADSHEET_ID").getSheetByName("シート1");
          var data = JSON.parse(e.postData.contents);

          var fileBlob = Utilities.newBlob(Utilities.base64Decode(data.photo), "image/png", "upload.png");
          var folder = DriveApp.getFolderById("YOUR_DRIVE_FOLDER_ID"); // アップロード先のGoogleドライブフォルダID
          var file = folder.createFile(fileBlob);
          var fileUrl = file.getUrl(); // Googleドライブの画像URL取得

          sheet.appendRow([data.name, data.furigana, data.dob, data.email, data.phone, data.job, data.schedule, data.experience, data.skills, data.motivation, fileUrl]);

          return ContentService.createTextOutput("登録完了").setMimeType(ContentService.MimeType.TEXT);
        }
    </script>
    function doPost(e) {
  var sheet = SpreadsheetApp.openById("YOUR_SPREADSHEET_ID").getSheetByName("シート1");
  var data = JSON.parse(e.postData.contents);

  var fileBlob = Utilities.newBlob(Utilities.base64Decode(data.photo), "image/png", "upload.png");
  var folder = DriveApp.getFolderById("YOUR_DRIVE_FOLDER_ID"); // アップロード先のGoogleドライブフォルダID
  var file = folder.createFile(fileBlob);
  var fileUrl = file.getUrl(); // Googleドライブの画像URL取得

  sheet.appendRow([data.name, data.furigana, data.dob, data.email, data.phone, data.job, data.schedule, data.experience, data.skills, data.motivation, fileUrl]);

  return ContentService.createTextOutput("登録完了").setMimeType(ContentService.MimeType.TEXT);
}
    
</body>
</html>
