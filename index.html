<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>インターン希望者登録ページ</title>
    <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js">        document.getElementById('drop-area').addEventListener('click', function() {
            document.getElementById('photo').click();
        });

        document.getElementById('drop-area').addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.borderColor = '#000';
        });

        document.getElementById('drop-area').addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.style.borderColor = '#ccc';
        });

        document.getElementById('drop-area').addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.borderColor = '#ccc';
            const file = e.dataTransfer.files[0];
            document.getElementById('photo').files = e.dataTransfer.files;
            if (file) {
                this.textContent = file.name;
            }
        });

        document.getElementById('photo').addEventListener('change', function() {
            if (this.files.length > 0) {
                document.getElementById('drop-area').textContent = this.files[0].name;
            }
        });
            function validateForm() {
            let isValid = true;
            document.querySelectorAll(".error").forEach(el => el.textContent = "");
            let formData = {};
            document.querySelectorAll("[required]").forEach(input => {
                if (!input.value.trim()) {
                    let errorElement = document.getElementById("error-" + input.id);
                    if (errorElement) {
                        errorElement.textContent = "未入力です";
                    }
                    isValid = false;
                } else {
                    formData[input.id] = input.value;
                }
            });
            
            let fileInput = document.getElementById("photo");
            if (fileInput.files.length > 0) {
                let reader = new FileReader();
                reader.onloadend = function () {
                    formData.photo = reader.result.split(',')[1]; // Base64データを取得
                    
                    // EmailJS で画像付きで送信
                    emailjs.send("YOUR_SERVICE_ID", "YOUR_TEMPLATE_ID", formData)
                        .then(response => console.log("メール送信成功", response.status, response.text))
                        .catch(error => console.log("メール送信失敗", error));
                    
                    // Google ドライブにアップロード
                    uploadToDrive(fileInput.files[0], function(photoUrl) {
                        formData.photoUrl = photoUrl;
                        
                        // Googleスプレッドシートへデータ送信
                        fetch("https://script.google.com/macros/s/YOUR_DEPLOYED_WEB_APP_URL/exec", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(formData)
                        })
                        .then(response => response.text())
                        .then(data => console.log("Googleスプレッドシートに登録成功: ", data))
                        .catch(error => console.log("Googleスプレッドシート登録失敗: ", error));
                    });
                };
                reader.readAsDataURL(fileInput.files[0]);
            }
        }
        
        function uploadToDrive(file, callback) {
            let reader = new FileReader();
            reader.onloadend = function () {
                let base64Data = reader.result.split(',')[1];
                
                fetch("https://script.google.com/macros/s/YOUR_DEPLOYED_WEB_APP_URL/exec", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ fileName: file.name, mimeType: file.type, data: base64Data })
                })
                .then(response => response.text())
                .then(url => {
                    console.log("Googleドライブにアップロード成功: ", url);
                    callback(url);
                })
                .catch(error => console.log("Googleドライブアップロード失敗: ", error));
            };
            reader.readAsDataURL(file);
        }
    </script>
    <style>
        body { font-family: Arial, sans-serif; }
        form { max-width: 500px; margin: auto; padding: 20px; border: 1px solid #ccc; border-radius: 10px; }
        label { display: block; margin-top: 10px; }
        select, textarea, input { width: 100%; padding: 8px; margin-top: 5px; }
        .error { color: red; font-size: 0.9em; }
        .buttons { margin-top: 15px; display: flex; flex-direction: column; align-items: center; }
        .dob-container { display: flex; gap: 10px; align-items: center; }
        .dob-container select { width: 32%; }
        .privacy-policy { font-size: 0.9em; text-align: center; margin-bottom: 10px; }
        #drop-area { border: 2px dashed #ccc; padding: 20px; text-align: center; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>
    <h2 style="text-align: center;">インターン希望者登録ページ</h2>
    <form id="registrationForm">
        <label>・名前（<span style="color: red;">必須</span>）<input type="text" id="name" required></label>
        <span class="error" id="error-name"></span>
        
        <label>・フリガナ（<span style="color: red;">必須</span>）<input type="text" id="furigana" required></label>
        <span class="error" id="error-furigana"></span>
        
        <label>・写真アップロード（<span style="color: red;">必須</span>）</label>
        <div id="drop-area">ここにファイルをドラッグ&ドロップするか、クリックして選択</div>
        <input type="file" id="photo" accept="image/*" required style="display: none;">
        <span class="error" id="error-photo"></span>
        
        <div class="buttons">
            <button type="button" onclick="validateForm()">登録</button>
        </div>
    </form>

    <script>
        function validateForm() {
            let isValid = true;
            document.querySelectorAll(".error").forEach(el => el.textContent = "");
            let formData = {};
            document.querySelectorAll("[required]").forEach(input => {
                if (!input.value.trim()) {
                    let errorElement = document.getElementById("error-" + input.id);
                    if (errorElement) {
                        errorElement.textContent = "未入力です";
                    }
                    isValid = false;
                } else {
                    formData[input.id] = input.value;
                }
            });
            
            let fileInput = document.getElementById("photo");
            if (fileInput.files.length > 0) {
                let reader = new FileReader();
                reader.onloadend = function () {
                    formData.photo = reader.result.split(',')[1]; // Base64データを取得
                    emailjs.send("YOUR_SERVICE_ID", "YOUR_TEMPLATE_ID", formData)
                        .then(response => console.log("メール送信成功", response.status, response.text))
                        .catch(error => console.log("メール送信失敗", error));
                };
                reader.readAsDataURL(fileInput.files[0]);
            }
        }

        document.getElementById('drop-area').addEventListener('click', function() {
            document.getElementById('photo').click();
        });

        document.getElementById('drop-area').addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.borderColor = '#000';
        });

        document.getElementById('drop-area').addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.style.borderColor = '#ccc';
        });

        document.getElementById('drop-area').addEventListener('drop', function(e) {
            e.preventDefault();
            const file = e.dataTransfer.files[0];
            document.getElementById('photo').files = e.dataTransfer.files;
            this.textContent = file.name;
        });

        document.getElementById('photo').addEventListener('change', function() {
            if (this.files.length > 0) {
                document.getElementById('drop-area').textContent = this.files[0].name;
            }
        });
    </script>
</body>
</html>
